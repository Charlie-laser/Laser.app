<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Google Sheet Database</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #status { font-style: italic; color: blue; margin-top: 10px; }
    #success { color: green; font-weight: bold; margin-top: 10px; display: none; }
    #databases { margin-top: 20px; }
    .db-item { padding: 8px; border: 1px solid #ccc; margin: 5px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>Add Google Sheet Database</h2>
  <input type="text" id="sheetUrl" placeholder="Paste Google Sheet link here" size="100">
  <button onclick="addSheet()">Add</button>
  <div id="status"></div>
  <div id="success">✅ Uploading done!</div>

  <h3>Databases</h3>
  <div id="databases"></div>

  <script>
    async function addSheet() {
      const url = document.getElementById("sheetUrl").value;
      const status = document.getElementById("status");
      const success = document.getElementById("success");

      // Loading start
      status.textContent = "⌛ Loading data from Google Sheet...";
      success.style.display = "none";

      try {
        // Convert link to CSV
        let csvUrl = url;
        if (!url.includes("output=csv")) {
          if (url.includes("/edit")) {
            csvUrl = url.replace("/edit", "/gviz/tq?tqx=out:csv");
          } else {
            csvUrl += "&output=csv";
          }
        }

        // Fetch CSV
        const response = await fetch(csvUrl);
        if (!response.ok) throw new Error("Failed to fetch");

        const data = await response.text();

        // সব ডাটা লোড হওয়ার পরেই Database এ যোগ করব
        addDatabaseEntry("Google Sheet DB", data);

        // Done দেখানো
        status.textContent = "";
        success.style.display = "block";

      } catch (err) {
        status.textContent = "❌ Failed to fetch from Google Sheet!";
        console.error(err);
      }
    }

    // Database লিস্টে এন্ট্রি যোগ
    function addDatabaseEntry(name, data) {
      const dbList = document.getElementById("databases");
      const div = document.createElement("div");
      div.className = "db-item";
      div.textContent = name + " (" + data.split("\n").length + " rows)";
      dbList.appendChild(div);
    }
  </script>
</body>
</html>
